# V2-010 Heartbeat and Lease Infrastructure

## Scope
Add persisted heartbeat state for agents and lease ownership/expiry state for in-progress tasks, including acquire/renew/release runtime paths.

## Implemented
1. Migration for heartbeat + lease columns/indexes:
   - `mcp/store/migrations/005_agent_heartbeat_and_task_leases.sql`
2. Store lease/heartbeat logic:
   - `mcp/store/sqlite-store.ts`
   - `mcp/store/entities.ts`
3. Lease tool surface for runtime operations:
   - `mcp/server/tools/leases.ts`
   - `mcp/schemas/tools/team_agent_heartbeat.schema.json`
   - `mcp/schemas/tools/team_task_lease_acquire.schema.json`
   - `mcp/schemas/tools/team_task_lease_renew.schema.json`
   - `mcp/schemas/tools/team_task_lease_release.schema.json`
   - `mcp/schemas/contracts.ts`
4. Contention/expiry recovery tests:
   - `tests/unit/v2-010.heartbeat-leases.test.ts`
   - `tests/integration/v2-010.heartbeat-leases.integration.test.ts`

## Acceptance Criteria
1. Lease contention is enforced (single owner unless expired/released).
2. Expired leases are recoverable safely by another agent.
3. Renew/release paths preserve task consistency.
4. Agent heartbeat timestamps persist.

## Evidence
- `docs/v2-baseline/v2-010-heartbeat-leases.txt`
